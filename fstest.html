<script
    id="fsc-api"
    src="https://d1f8f9xcsvx3ha.cloudfront.net/sbl/0.8.3/fastspring-builder.min.js"
    type="text/javascript"
    data-storefront="fastspringexamples.onfastspring.com/popup-fastspringexamples"
    data-popup-closed="fsPopup"
    data-popup-webhook-received="fsBrowserHook"
    data-popup-event-received="fsPopupEvent"
    continuous="true">
</script>


<script type="text/javascript">
  var purchasedEvent = false;
  var orderComplete = false;
  
	function fsPopup(fsData) {
		if (fsData && fsData.reference && orderComplete) {
      console.log("Order Complete");
			console.log(`Order data from popup closed is ID: ${fsData.id} & REF: ${fsData.reference}`)
			// ORDER COMPLETED
			// REDIRECT TO PSP USER AREA IF DESIRED
			fastspring.builder.reset()
		} else if (fsData && fsData.id && purchasedEvent && !orderComplete) {
      // If the checkout purchase event has completed but the order is not yet fully complete (paid)
      // then it is pending payment:
      console.log("Pending Payment");
			console.log(`Order data from popup closed is ID: ${fsData.id}`)
			// ORDER PENDING
			// MAKE AJAX CALL WITH fsData.id
			// REDIRECT TO PSP USER AREA IF DESIRED
			fastspring.builder.reset()
		} else {
			console.log('No order completed')
		}
	};
	function fsBrowserHook(fsOrderData) {
		if (fsOrderData) {
      orderComplete = true;
			console.log(`Order data from browser hook is ID: ${fsOrderData.id}`)
			// MAKE AJAX/FETCH CALL if order is completed
		} else {
      // If the order has not completed (i.e. been fully paid) then we flag that.
      orderComplete = false;
		}
		console.log(">> orderComplete = " + orderComplete);
    }

    function fsPopupEvent(fsEventData) {
	    console.log(">> fsPopupEvent");
	    console.log(">> " + fsEventData.event);
      if (fsEventData) {
        if (fsEventData.event == "FSC-purchaseComplete" && fsEventData.fsc-eventAction == "Purchase Complete") {
          purchasedEvent = true;
        } else {
          purchasedEvent = false;
        }
      }
	    console.log(">> purchasedEvent = " + purchasedEvent);
    }
	
</script>
<script type="text/javascript">
	function buyFS() {
		fastspring.builder.add('phot-io-main-app');
		fastspring.builder.checkout();
	};
</script>

<button onclick="buyFS();">Buy</button>
